import time
import jieba
from models import NgramsLanguageModel

#model = NgramsLanguageModel.from_pretrained("./models_collect/thucnews_lm_model")
model = NgramsLanguageModel.from_pretrained("./thucnews_lm_model")

def ngram_model_perplexity(paragram):
    ppl = model.perplexity(
            x=jieba.lcut(paragram),   # 经过切词的句子或段落
            verbose=False,     # 是否显示详细的probability，default=False
        )

    return ppl


if __name__=='__main__':
    output_article = """
    ### Sedimentological Insights into Carbonate Systems: Processes and Implications\n\nThe diverse and dynamic nature of carbonate sedimentary systems necessitates a comprehensive understanding of various geological processes, including deposition, compaction, and diagenesis, as well as their interactions with biological and chemical environmental factors. In this context, several pertinent concepts such as ripple bedding, undulating bedding, and carbonate dissolution highlight the intricate relationships in sedimentary geology. These insights are vital for advancing our knowledge in areas ranging from stratigraphic analysis to resource exploration.\n\n#### 1. Carbonate Detrital Input in Turbidite Layers\nTurbidites, deposited predominantly in deep marine settings, occasionally exhibit substantial inputs of carbonate detritus, inferred from ripple bedding structures. These features suggest sporadic, high-energy events where material is mobilized down-slope, coupling allochthonous carbonate material with siliciclastic systems. Recognition of such features determines the interaction of pelagic and terrigenous inputs and influences hydrocarbon reservoir characterization.\n\n#### 2. Carbonate Dissolution and Re-Precipitation in Calcrete Profiles\nCalcrete terrains typically undergo a complex diagenetic process involving carbonate dissolution followed by reprecipitation. This cycle alters the primary calcrete profile, impacting soil fertility and structural stability. As rainwater percolates through the soil, it dissolves primary calcite, which later reprecipitates to form denser, less permeable layers at deeper levels. These transformations are crucial for understanding soil development in arid regions.\n\n#### 3. Clasts Contacts with Carbonate Structures\nIn conglomerates and breccias, the contacts between clasts and surrounding carbonate matrices provide crucial clues about the paleoenvironmental conditions. Interactions at the grain boundaries, including sutured and floating contacts, often point to varying degrees of compaction and subsequent cementation, affecting porosity and permeability of the rock.\n\n#### 4. Compaction Process in Carbonate Oozes\nThe transformation of carbonate ooze to limestone under the immense pressure of overlying sediments involves significant compaction. This process expels pore water and brings calcareous particles into closer contact, thus enhancing lithification. Recognition of compaction effects is inferred from flattened microfossil shapes and reduced porosity in deep-sea cores.\n\n#### 5. Carbonates Affected by Intense Compaction\nIntensely compacted carbonates, frequently observed in subduction zones or overburdened continental shelves, exhibit characteristics such as stylolites and pressure-solution seams. These features indicate substantial post-depositional weight bearing and are vital in evaluating the mechanical properties and potential fracture zones within the carbonate sequences.\n\n#### 6. Carbonates Affect Content of Phosphorus in Clays\nThe interaction between carbonates and clays can notably influence the cycling of nutrients, particularly phosphorus. Carbonates can bind phosphate ions and affect their availability in the ecosystem, which is crucial for modeling nutrient dynamics in sedimentary basins and their biological productivity.\n\n#### 7. Dissolution Affected Carbonate Allochems\nAllochems, such as ooids or peloids, often show signs of dissolution in their microstructures, characteristics typically examined under scanning electron microscopy. This dissolution can alter the original depositional fabric and give rise to secondary porosity, crucial for fluid flow in hydrocarbon reservoirs.\n\n#### 8. Cementation Typical Temperatures Carbonate Diagenesis\nDuring diagenesis, carbonate cementation typically occurs at temperatures ranging between 30 to 50 degrees Celsius. At such temperatures, carbonate solubility decreases, facilitating precipitation of calcite or aragonite from saturated pore waters, effectively reducing rock porosity.\n\n#### 9. Caliche Increases Thickness in Impregnated Shales\nIn semi-arid regions, caliche horizons can substantially increase the thickness of impregnated shales. The caliche layers, rich in calcium carbonate, act as impermeable barriers that can impede fluid movement and affect the vertical growth of shale formations. This characteristic is especially significant in evaluating shale\u2019s petroleum potential.\n\n### Conclusion\nUnderstanding the intricate processes involved in carbonate sedimentology, from ripple and undulating bedding formations, through compaction, to diagenetic alterations, provides not only a framework for interpreting Earth\u2019s geological past but also insights into future environmental and industrial applications. As sedimentologists, connecting these processes with observable sedimentary structures and geochemical signatures continues to challenge and advance our geological knowledge frontiers.
    """
    ppl = ngram_model_perplexity(output_article)
    print(f"困惑度: {ppl:.5f}")
